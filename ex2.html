<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exerc√≠cio 2</title>
    <!-- include three.js library -->
    <script src='js/three.min.js'></script>
    <script src='js/OBJLoader.js'></script>
    <script src='js/MTLLoader.js'></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
</head>
<body>
    <script>
        var scene, camera, renderer, clock, deltaTime, totalTime;

        var arToolkitSource, arToolkitContext;

        let markerRoot;

        let markerControls1, markerControls2, markerControlsA, markerControlsB, markerControlsC, markerControlsD, markerControlsF, markerControlsG;
        let markerLetterA, markerLetterB, markerLetterC, markerLetterD, markerLetterF, markerLetterG;

        let sceneGroupModel;

        let meshA, meshB, meshC, meshD, meshG, meshF;

        initialize();
        animate();

        function initialize() {
            scene = new THREE.Scene();

            camera = new THREE.Camera();
            scene.add(camera);

            renderer = new THREE.WebGLRenderer({
                antialias : true,
                alpha: true
            });
            renderer.setClearColor(new THREE.Color('lightgrey'), 0)
            renderer.setSize( 640, 480 );
            renderer.domElement.style.position = 'absolute'
            renderer.domElement.style.top = '0px'
            renderer.domElement.style.left = '0px'
            document.body.appendChild( renderer.domElement );

            clock = new THREE.Clock();
            deltaTime = 0;
            totalTime = 0;

            ////////////////////////////////////////////////////////////
            // setup arToolkitSource
            ////////////////////////////////////////////////////////////

            arToolkitSource = new THREEx.ArToolkitSource({
                sourceType : 'webcam',
            });

            function onResize()
            {
                arToolkitSource.onResizeElement()
                arToolkitSource.copyElementSizeTo(renderer.domElement)
                if ( arToolkitContext.arController !== null )
                {
                    arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)
                }
            }

            arToolkitSource.init(function onReady(){
                onResize()
            });

            // handle resize event
            window.addEventListener('resize', function(){
                onResize()
            });

            ////////////////////////////////////////////////////////////
            // setup arToolkitContext
            ////////////////////////////////////////////////////////////

            // create atToolkitContext
            arToolkitContext = new THREEx.ArToolkitContext({
                cameraParametersUrl: 'data/camera_para.dat',
                detectionMode: 'mono'
            });

            // copy projection matrix to camera when initialization complete
            arToolkitContext.init( function onCompleted(){
                camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
            });

            ////////////////////////////////////////////////////////////
            // setup markerRoots
            ////////////////////////////////////////////////////////////

            // build markerControls
            markerRoot1 = new THREE.Group();
            scene.add(markerRoot1);
            markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
                type: 'pattern', patternUrl: "data/hiro.patt",
            });

            markerRoot2 = new THREE.Group();
            scene.add(markerRoot2);
            markerControls2 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot2, {
                type: 'pattern', patternUrl: "data/kanji.patt",
            });

            markerLetterA = new THREE.Group();
            markerControlsA = new THREEx.ArMarkerControls(arToolkitContext, markerLetterA, {
                type: 'pattern', patternUrl: "data/letterA.patt",
            });

            markerLetterB = new THREE.Group();
            markerControlsB = new THREEx.ArMarkerControls(arToolkitContext, markerLetterB, {
                type: 'pattern', patternUrl: "data/letterB.patt",
            });

            markerLetterC = new THREE.Group();
            markerControlsC = new THREEx.ArMarkerControls(arToolkitContext, markerLetterC, {
                type: 'pattern', patternUrl: "data/letterC.patt",
            })

            markerLetterD = new THREE.Group();
            markerControlsD = new THREEx.ArMarkerControls(arToolkitContext, markerLetterD, {
                type: 'pattern', patternUrl: "data/letterD.patt",
            });

            markerLetterG = new THREE.Group();
            markerControlsG = new THREEx.ArMarkerControls(arToolkitContext, markerLetterG, {
                type: 'pattern', patternUrl: "data/letterG.patt",
            });

            markerLetterF = new THREE.Group();
            markerControlsF = new THREEx.ArMarkerControls(arToolkitContext, markerLetterF, {
                type: 'pattern', patternUrl: "data/letterF.patt",
            });

            ////////////////////////////////////////////////////////////
            // setup scene
            ////////////////////////////////////////////////////////////

            meshA = new THREE.Mesh(
                new THREE.CubeGeometry(1.25,1.25,1.25),
                new THREE.MeshBasicMaterial({color:0xff0000, transparent:true, opacity:0.5})
            );
            markerLetterA.add( meshA );

            meshB = new THREE.Mesh(
                new THREE.CubeGeometry(1.25,1.25,1.25),
                new THREE.MeshBasicMaterial({color:0xff8800, transparent:true, opacity:0.5})
            );
            markerLetterB.add( meshB );

            meshC = new THREE.Mesh(
                new THREE.CubeGeometry(1.25,1.25,1.25),
                new THREE.MeshBasicMaterial({color:0xffff00, transparent:true, opacity:0.5})
            );
            markerLetterC.add( meshC );

            meshD = new THREE.Mesh(
                new THREE.CubeGeometry(1.25,1.25,1.25),
                new THREE.MeshBasicMaterial({color:0x00cc00, transparent:true, opacity:0.5})
            );
            markerLetterD.add( meshD );

            meshG = new THREE.Mesh(
                new THREE.CubeGeometry(1.25,1.25,1.25),
                new THREE.MeshBasicMaterial({color:0x0000ff, transparent:true, opacity:0.5})
            );
            markerLetterG.add( meshG );

            meshF = new THREE.Mesh(
                new THREE.CubeGeometry(1.25,1.25,1.25),
                new THREE.MeshBasicMaterial({color:0xcc00ff, transparent:true, opacity:0.5})
            );
            markerLetterF.add( meshF );

            //Parte de carregamento do modelinho
            function onProgress(xhr) { console.log( (xhr.loaded / xhr.total * 100) + '% loaded' ); }
            function onError(xhr) { console.log( 'An error happened' ); }

            sceneGroupModel = new THREE.Mesh(
                new THREE.SphereGeometry(0.5, 20, 20),
                new THREE.MeshBasicMaterial({color:'pink', transparent:true, opacity:0.8})
            );

            // sceneGroupModel = new THREE.Group();
            //
            // new THREE.MTLLoader()
            //     .setPath( 'models/' )
            //     .load( 'female02.mtl', function ( materials ) {
            //         materials.preload();
            //         new THREE.OBJLoader()
            //             .setMaterials( materials )
            //             .setPath( 'models/' )
            //             .load( 'female02.obj', function ( object ) {
            //                 object.position.set(0, 0, 0);
            //                 object.scale.set(0.01, 0.01, 0.01);
            //                 object.traverse(function(child){
            //                     child.castShadow = true;
            //                 });
            //                 sceneGroupModel.add(object);
            //             }, onProgress, onError );
            //     } );
        }

        function load(){

        }

        function animate()
        {
            requestAnimationFrame(animate);
            deltaTime = clock.getDelta();
            totalTime += deltaTime;
            update();
            render();
        }

        function update()
        {
            if(markerControls1.object3d.visible) {
                //console.log("visivel");
                markerLetterA.remove( sceneGroupModel );
                markerLetterC.remove( sceneGroupModel );
                markerLetterD.remove( sceneGroupModel );
                markerLetterG.remove( sceneGroupModel );
                markerLetterF.remove( sceneGroupModel );
                markerLetterB.remove( sceneGroupModel );

                markerLetterA.add(meshA);
                markerLetterB.add(meshB);
                markerLetterC.add(meshC);
                markerLetterD.add(meshD);
                markerLetterF.add(meshF);
                markerLetterG.add(meshG);

                scene.add(markerLetterA);
                scene.add(markerLetterB);
                scene.add(markerLetterC);
                scene.add(markerLetterD);
                scene.add(markerLetterG);
                scene.add(markerLetterF);
            }
            else if(markerControls2.object3d.visible){
                //console.log("kanjiii");

                markerLetterA.remove(meshA);
                markerLetterB.remove(meshB);
                markerLetterC.remove(meshC);
                markerLetterD.remove(meshD);
                markerLetterF.remove(meshF);
                markerLetterG.remove(meshG);

                if(markerControlsA.object3d.visible){
                    markerLetterA.add( sceneGroupModel );
                    scene.add(markerLetterA);
                }

                else if(markerControlsB.object3d.visible){
                    markerLetterB.add( sceneGroupModel );
                    scene.add(markerLetterB);
                }

                else if(markerControlsC.object3d.visible){
                    markerLetterC.add( sceneGroupModel );
                    scene.add(markerLetterC);
                }

                else if(markerControlsD.object3d.visible){
                    markerLetterD.add( sceneGroupModel );
                    scene.add(markerLetterD);
                }

                else if(markerControlsF.object3d.visible){
                    markerLetterF.add( sceneGroupModel );
                    scene.add(markerLetterF);
                }

                else if(markerControlsG.object3d.visible){
                    markerLetterG.add( sceneGroupModel );
                    scene.add(markerLetterG);
                }


                // markerLetterA.add( sceneGroupModel );
                // markerLetterC.add( sceneGroupModel );
                // markerLetterD.add( sceneGroupModel );
                // markerLetterG.add( sceneGroupModel );
                // markerLetterF.add( sceneGroupModel );
                // markerLetterB.add( sceneGroupModel );
                //
                //
                // scene.add(markerLetterB);
                // scene.add(markerLetterC);
                // scene.add(markerLetterD);
                // scene.add(markerLetterG);
                // scene.add(markerLetterF);
            }
            else{
                //console.log("fora");
                scene.remove(markerLetterA);
                scene.remove(markerLetterB);
                scene.remove(markerLetterC);
                scene.remove(markerLetterD);
                scene.remove(markerLetterG);
                scene.remove(markerLetterF);
            }
            // update artoolkit on every frame
            if ( arToolkitSource.ready !== false )
                arToolkitContext.update( arToolkitSource.domElement );
        }

        function render()
        {
            renderer.render( scene, camera );
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exerc√≠cio 4</title>
    <!-- include three.js library -->
    <script src='js/three.min.js'></script>
    <script src='js/GLTF2Loader.js'></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
</head>
<body>
<script>
    var scene, camera, renderer, clock, deltaTime, totalTime;

    var arToolkitSource, arToolkitContext;

    let markerRoot1, markerRoot2, markerRoot3, markerRoot4, markerRoot5;
    let markerControls1, markerControls2, markerControls3, markerControls4, markerControls5;

    let markerLetterA, markerLetterB, markerLetterC, markerLetterD, markerLetterF, markerLetterG;
    let markerControlsA, markerControlsB, markerControlsC, markerControlsD, markerControlsF, markerControlsG;

    let sceneGroupModel = new THREE.Group();
    let sceneGroupModel1 = new THREE.Group();
    let sceneGroupModel2 = new THREE.Group();
    let sceneGroupModel3 = new THREE.Group();
    let sceneGroupModel4 = new THREE.Group();
    let sceneGroupModel5 = new THREE.Group();

    const objs1 = [];
    const objs2 = [];
    const objs3 = [];
    const objs4 = [];
    const objs5 = [];
    let gltf1, gltf2, gltf3, gltf4, gltf5;

    initialize();
    animate();

    function initialize() {
        scene = new THREE.Scene();

        camera = new THREE.Camera();
        scene.add(camera);

        renderer = new THREE.WebGLRenderer({
            antialias : true,
            alpha: true
        });
        renderer.setClearColor(new THREE.Color('lightgrey'), 0)
        renderer.setSize( 640, 480 );
        renderer.domElement.style.position = 'absolute'
        renderer.domElement.style.top = '0px'
        renderer.domElement.style.left = '0px'
        document.body.appendChild( renderer.domElement );

        clock = new THREE.Clock();
        deltaTime = 0;
        totalTime = 0;

        ////////////////////////////////////////////////////////////
        // setup arToolkitSource
        ////////////////////////////////////////////////////////////

        arToolkitSource = new THREEx.ArToolkitSource({
            sourceType : 'webcam',
        });

        function onResize()
        {
            arToolkitSource.onResizeElement()
            arToolkitSource.copyElementSizeTo(renderer.domElement)
            if ( arToolkitContext.arController !== null )
            {
                arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)
            }
        }

        arToolkitSource.init(function onReady(){
            onResize()
        });

        // handle resize event
        window.addEventListener('resize', function(){
            onResize()
        });

        ////////////////////////////////////////////////////////////
        // setup arToolkitContext
        ////////////////////////////////////////////////////////////

        // create atToolkitContext
        arToolkitContext = new THREEx.ArToolkitContext({
            cameraParametersUrl: 'data/camera_para.dat',
            detectionMode: 'mono'
        });

        // copy projection matrix to camera when initialization complete
        arToolkitContext.init( function onCompleted(){
            camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
        });

        ////////////////////////////////////////////////////////////
        // setup markerRoots
        ////////////////////////////////////////////////////////////

        // build markerControls
        markerRoot1 = new THREE.Group();
        scene.add(markerRoot1);
        markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
            type: 'pattern', patternUrl: "data/1.patt",
        });

        markerRoot2 = new THREE.Group();
        scene.add(markerRoot2);
        markerControls2 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot2, {
            type: 'pattern', patternUrl: "data/2.patt",
        });

        markerRoot3 = new THREE.Group();
        scene.add(markerRoot3);
        markerControls3 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot3, {
            type: 'pattern', patternUrl: "data/3.patt",
        });

        markerRoot4 = new THREE.Group();
        scene.add(markerRoot4);
        markerControls4 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot4, {
            type: 'pattern', patternUrl: "data/4.patt",
        });

        markerRoot5 = new THREE.Group();
        scene.add(markerRoot5);
        markerControls5 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot5, {
            type: 'pattern', patternUrl: "data/5.patt",
        });

        markerLetterA = new THREE.Group();
        markerControlsA = new THREEx.ArMarkerControls(arToolkitContext, markerLetterA, {
            type: 'pattern', patternUrl: "data/letterA.patt",
        });

        markerLetterB = new THREE.Group();
        markerControlsB = new THREEx.ArMarkerControls(arToolkitContext, markerLetterB, {
            type: 'pattern', patternUrl: "data/letterB.patt",
        });

        markerLetterC = new THREE.Group();
        markerControlsC = new THREEx.ArMarkerControls(arToolkitContext, markerLetterC, {
            type: 'pattern', patternUrl: "data/letterC.patt",
        });

        markerLetterD = new THREE.Group();
        markerControlsD = new THREEx.ArMarkerControls(arToolkitContext, markerLetterD, {
            type: 'pattern', patternUrl: "data/letterD.patt",
        });

        markerLetterG = new THREE.Group();
        markerControlsG = new THREEx.ArMarkerControls(arToolkitContext, markerLetterG, {
            type: 'pattern', patternUrl: "data/letterG.patt",
        });

        markerLetterF = new THREE.Group();
        markerControlsF = new THREEx.ArMarkerControls(arToolkitContext, markerLetterF, {
            type: 'pattern', patternUrl: "data/letterF.patt",
        });

        ////////////////////////////////////////////////////////////
        // setup scene
        ////////////////////////////////////////////////////////////

        // sceneGroupModel1 = new THREE.Mesh(
        //     new THREE.CubeGeometry(1.25,1.25,1.25),
        //     new THREE.MeshBasicMaterial({color:0xff0000, transparent:true, opacity:0.5})
        // );
        // markerLetterA.add( sceneGroupModel1 );
        //
        // sceneGroupModel2 = new THREE.Mesh(
        //     new THREE.CubeGeometry(1.25,1.25,1.25),
        //     new THREE.MeshBasicMaterial({color:0xff8800, transparent:true, opacity:0.5})
        // );
        // markerLetterB.add( sceneGroupModel2 );
        //
        // sceneGroupModel3 = new THREE.Mesh(
        //     new THREE.CubeGeometry(1.25,1.25,1.25),
        //     new THREE.MeshBasicMaterial({color:0xffff00, transparent:true, opacity:0.5})
        // );
        // markerLetterC.add( sceneGroupModel3 );
        //
        // sceneGroupModel4 = new THREE.Mesh(
        //     new THREE.CubeGeometry(1.25,1.25,1.25),
        //     new THREE.MeshBasicMaterial({color:0x00cc00, transparent:true, opacity:0.5})
        // );
        // markerLetterD.add( sceneGroupModel4 );
        //
        // sceneGroupModel5 = new THREE.Mesh(
        //     new THREE.CubeGeometry(1.25,1.25,1.25),
        //     new THREE.MeshBasicMaterial({color:0x0000ff, transparent:true, opacity:0.5})
        // );
        // markerLetterG.add( sceneGroupModel5 );

        let light = new THREE.PointLight( 0xffffff, 1, 100 );
        light.position.set( 0,4,0 ); // default; light shining from top
        light.castShadow = true;
        camera.add( light );

        const loader = new THREE.GLTF2Loader();
        loader.load(
            'models/BrainStem.gltf',
            ( gltf1 ) => {
                // called when the resource is loaded

                const mixer = new THREE.AnimationMixer(gltf1.scene);
                // animations is a list of THREE.AnimationClip
                for (const anim of gltf1.animations) {
                    mixer.clipAction(anim).play();
                }
                sceneGroupModel1.add( gltf1.scene );
                objs1.push({gltf1, mixer});
            },
            ( xhr ) => {
                // called while loading is progressing
                console.log( `${( xhr.loaded / xhr.total * 100 )}% loaded` );
            },
            ( error ) => {
                // called when loading has errors
                console.error( 'An error happened', error );
            },
        );

        loader.load(
            'models/CesiumMan.gltf',
            ( gltf2 ) => {
                // called when the resource is loaded

                const mixer = new THREE.AnimationMixer(gltf2.scene);
                // animations is a list of THREE.AnimationClip
                for (const anim of gltf2.animations) {
                    mixer.clipAction(anim).play();
                }
                sceneGroupModel2.add( gltf2.scene );
                objs2.push({gltf2, mixer});
            },
            ( xhr ) => {
                // called while loading is progressing
                console.log( `${( xhr.loaded / xhr.total * 100 )}% loaded` );
            },
            ( error ) => {
                // called when loading has errors
                console.error( 'An error happened', error );
            },
        );

        loader.load(
            'models/CesiumMilkTruck.gltf',
            ( gltf3 ) => {
                // called when the resource is loaded

                const mixer = new THREE.AnimationMixer(gltf3.scene);
                // animations is a list of THREE.AnimationClip
                for (const anim of gltf3.animations) {
                    mixer.clipAction(anim).play();
                }
                sceneGroupModel3.add( gltf3.scene );
                objs3.push({gltf3, mixer});
            },
            ( xhr ) => {
                // called while loading is progressing
                console.log( `${( xhr.loaded / xhr.total * 100 )}% loaded` );
            },
            ( error ) => {
                // called when loading has errors
                console.error( 'An error happened', error );
            },
        );

        loader.load(
            'models/Monster.gltf',
            ( gltf4 ) => {
                // called when the resource is loaded

                const mixer = new THREE.AnimationMixer(gltf4.scene);
                // animations is a list of THREE.AnimationClip
                for (const anim of gltf4.animations) {
                    mixer.clipAction(anim).play();
                }
                gltf4.scene.scale.set(0.1,0.1,0.1);
                sceneGroupModel4.add( gltf4.scene );
                objs4.push({gltf4, mixer});
            },
            ( xhr ) => {
                // called while loading is progressing
                console.log( `${( xhr.loaded / xhr.total * 100 )}% loaded` );
            },
            ( error ) => {
                // called when loading has errors
                console.error( 'An error happened', error );
            },
        );

        loader.load(
            'models/RiggedFigure.gltf',
            ( gltf5 ) => {
                // called when the resource is loaded

                const mixer = new THREE.AnimationMixer(gltf5.scene);
                // animations is a list of THREE.AnimationClip
                for (const anim of gltf5.animations) {
                    mixer.clipAction(anim).play();
                }
                sceneGroupModel5.add( gltf5.scene );
                objs5.push({gltf5, mixer});
            },
            ( xhr ) => {
                // called while loading is progressing
                console.log( `${( xhr.loaded / xhr.total * 100 )}% loaded` );
            },
            ( error ) => {
                // called when loading has errors
                console.error( 'An error happened', error );
            },
        );
    }
    function animate()
    {
        objs1.forEach(({mixer}) => {mixer.update(clock.getDelta());});
        objs2.forEach(({mixer}) => {mixer.update(clock.getDelta());});
        objs3.forEach(({mixer}) => {mixer.update(clock.getDelta());});
        objs4.forEach(({mixer}) => {mixer.update(clock.getDelta());});
        objs5.forEach(({mixer}) => {mixer.update(clock.getDelta());});
        requestAnimationFrame(animate);
        deltaTime = clock.getDelta();
        totalTime += deltaTime;
        update();
        render();
    }

    function update()
    {
        if(markerControls1.object3d.visible){
            //console.log("kanjiii");
            markerLetterA.remove(sceneGroupModel);
            markerLetterB.remove(sceneGroupModel);
            markerLetterC.remove(sceneGroupModel);
            markerLetterD.remove(sceneGroupModel);
            markerLetterF.remove(sceneGroupModel);
            markerLetterG.remove(sceneGroupModel);

            sceneGroupModel = sceneGroupModel1;

            if(markerControlsA.object3d.visible){
                markerLetterA.add( sceneGroupModel );
                scene.add(markerLetterA);
            }

            else if(markerControlsB.object3d.visible){
                markerLetterB.add( sceneGroupModel );
                scene.add(markerLetterB);
            }

            else if(markerControlsC.object3d.visible){
                markerLetterC.add( sceneGroupModel );
                scene.add(markerLetterC);
            }

            else if(markerControlsD.object3d.visible){
                markerLetterD.add( sceneGroupModel );
                scene.add(markerLetterD);
            }

            else if(markerControlsF.object3d.visible){
                markerLetterF.add( sceneGroupModel );
                scene.add(markerLetterF);
            }

            else if(markerControlsG.object3d.visible){
                markerLetterG.add( sceneGroupModel );
                scene.add(markerLetterG);
            }
        }
        else if(markerControls2.object3d.visible){
            //console.log("kanjiii");
            markerLetterA.remove(sceneGroupModel);
            markerLetterB.remove(sceneGroupModel);
            markerLetterC.remove(sceneGroupModel);
            markerLetterD.remove(sceneGroupModel);
            markerLetterF.remove(sceneGroupModel);
            markerLetterG.remove(sceneGroupModel);

            sceneGroupModel = sceneGroupModel2;

            if(markerControlsA.object3d.visible){
                markerLetterA.add( sceneGroupModel );
                scene.add(markerLetterA);
            }

            else if(markerControlsB.object3d.visible){
                markerLetterB.add( sceneGroupModel );
                scene.add(markerLetterB);
            }

            else if(markerControlsC.object3d.visible){
                markerLetterC.add( sceneGroupModel );
                scene.add(markerLetterC);
            }

            else if(markerControlsD.object3d.visible){
                markerLetterD.add( sceneGroupModel );
                scene.add(markerLetterD);
            }

            else if(markerControlsF.object3d.visible){
                markerLetterF.add( sceneGroupModel );
                scene.add(markerLetterF);
            }

            else if(markerControlsG.object3d.visible){
                markerLetterG.add( sceneGroupModel );
                scene.add(markerLetterG);
            }
        }
        else if(markerControls3.object3d.visible){
            //console.log("kanjiii");
            markerLetterA.remove(sceneGroupModel);
            markerLetterB.remove(sceneGroupModel);
            markerLetterC.remove(sceneGroupModel);
            markerLetterD.remove(sceneGroupModel);
            markerLetterF.remove(sceneGroupModel);
            markerLetterG.remove(sceneGroupModel);

            sceneGroupModel = sceneGroupModel3;

            if(markerControlsA.object3d.visible){
                markerLetterA.add( sceneGroupModel );
                scene.add(markerLetterA);
            }

            else if(markerControlsB.object3d.visible){
                markerLetterB.add( sceneGroupModel );
                scene.add(markerLetterB);
            }

            else if(markerControlsC.object3d.visible){
                markerLetterC.add( sceneGroupModel );
                scene.add(markerLetterC);
            }

            else if(markerControlsD.object3d.visible){
                markerLetterD.add( sceneGroupModel );
                scene.add(markerLetterD);
            }

            else if(markerControlsF.object3d.visible){
                markerLetterF.add( sceneGroupModel );
                scene.add(markerLetterF);
            }

            else if(markerControlsG.object3d.visible){
                markerLetterG.add( sceneGroupModel );
                scene.add(markerLetterG);
            }
        }
        else if(markerControls4.object3d.visible){
            //console.log("kanjiii");
            markerLetterA.remove(sceneGroupModel);
            markerLetterB.remove(sceneGroupModel);
            markerLetterC.remove(sceneGroupModel);
            markerLetterD.remove(sceneGroupModel);
            markerLetterF.remove(sceneGroupModel);
            markerLetterG.remove(sceneGroupModel);

            sceneGroupModel = sceneGroupModel4;

            if(markerControlsA.object3d.visible){
                markerLetterA.add( sceneGroupModel );
                scene.add(markerLetterA);
            }

            else if(markerControlsB.object3d.visible){
                markerLetterB.add( sceneGroupModel );
                scene.add(markerLetterB);
            }

            else if(markerControlsC.object3d.visible){
                markerLetterC.add( sceneGroupModel );
                scene.add(markerLetterC);
            }

            else if(markerControlsD.object3d.visible){
                markerLetterD.add( sceneGroupModel );
                scene.add(markerLetterD);
            }

            else if(markerControlsF.object3d.visible){
                markerLetterF.add( sceneGroupModel );
                scene.add(markerLetterF);
            }

            else if(markerControlsG.object3d.visible){
                markerLetterG.add( sceneGroupModel );
                scene.add(markerLetterG);
            }
        }
        else if(markerControls5.object3d.visible){
            //console.log("kanjiii");
            markerLetterA.remove(sceneGroupModel);
            markerLetterB.remove(sceneGroupModel);
            markerLetterC.remove(sceneGroupModel);
            markerLetterD.remove(sceneGroupModel);
            markerLetterF.remove(sceneGroupModel);
            markerLetterG.remove(sceneGroupModel);

            sceneGroupModel = sceneGroupModel5;

            if(markerControlsA.object3d.visible){
                markerLetterA.add( sceneGroupModel );
                scene.add(markerLetterA);
            }

            else if(markerControlsB.object3d.visible){
                markerLetterB.add( sceneGroupModel );
                scene.add(markerLetterB);
            }

            else if(markerControlsC.object3d.visible){
                markerLetterC.add( sceneGroupModel );
                scene.add(markerLetterC);
            }

            else if(markerControlsD.object3d.visible){
                markerLetterD.add( sceneGroupModel );
                scene.add(markerLetterD);
            }

            else if(markerControlsF.object3d.visible){
                markerLetterF.add( sceneGroupModel );
                scene.add(markerLetterF);
            }

            else if(markerControlsG.object3d.visible){
                markerLetterG.add( sceneGroupModel );
                scene.add(markerLetterG);
            }
        }
        else{
            //console.log("fora");
            scene.remove(markerLetterA);
            scene.remove(markerLetterB);
            scene.remove(markerLetterC);
            scene.remove(markerLetterD);
            scene.remove(markerLetterG);
            scene.remove(markerLetterF);
        }
        // update artoolkit on every frame
        if ( arToolkitSource.ready !== false )
            arToolkitContext.update( arToolkitSource.domElement );
    }

    function render()
    {
        renderer.render( scene, camera );
    }
</script>
</body>
</html>